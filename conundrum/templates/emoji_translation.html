<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji Translation Game</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>
    <h1>Emoji Translation Game</h1>
    <h2>Prompt: <span id="prompt"></span></h2>

    <!-- Display Emoji Translation Section -->
    <div id="emoji-translation">
        <label for="translation">Translate into emojis:</label>
        <input type="text" id="translation" placeholder="Enter emojis" />
        <button id="submit-translation">Submit Translation</button>
    </div>

    <!-- Display Guessing Section -->
    <div id="guessing-section" style="display:none;">
        <label for="guess">Your Guess:</label>
        <input type="text" id="guess" placeholder="Enter your guess" />
        <button id="submit-guess">Submit Guess</button>
    </div>

    <!-- Waiting for other players -->
    <div id="waiting" style="display:none;">
        <p>Waiting for other players...</p>
    </div>

    <script>
        const socket = io();
        const username = "{{ username }}"; // Ensure this is passed from Flask
        const lobbyCode = "{{ lobby_code }}"; // Same here

        let isHost = false;
        let isTranslationPhase = true;

        // Listening for game updates
        socket.on("game_update", (data) => {
            console.log("Received game update:", data);
            if (data.current_prompt) {
                document.getElementById("prompt").innerText = data.current_prompt;
            } else {
                document.getElementById("prompt").innerText = "Game Over!";
            }

            if (data.phase === 'guessing') {
                isTranslationPhase = false;
                document.getElementById("emoji-translation").style.display = "none";
                document.getElementById("guessing-section").style.display = "block";
                document.getElementById("waiting").style.display = "none";
            } else if (data.phase === 'translation') {
                isTranslationPhase = true;
                document.getElementById("emoji-translation").style.display = "block";
                document.getElementById("guessing-section").style.display = "none";
                document.getElementById("waiting").style.display = "none";
            }
        });

        // Submit translation (emoji translation)
        document.getElementById("submit-translation").addEventListener("click", () => {
            const translation = document.getElementById("translation").value;
            if (translation) {
                socket.emit("submit_translation", {
                    lobbyCode: lobbyCode,
                    username: username,
                    translation: translation
                });
                document.getElementById("emoji-translation").style.display = "none";
                document.getElementById("waiting").style.display = "block";  // Show waiting message
            }
        });

        // Submit guess
        document.getElementById("submit-guess").addEventListener("click", () => {
            const guess = document.getElementById("guess").value;
            if (guess) {
                socket.emit("submit_guess", {
                    lobbyCode: lobbyCode,
                    username: username,
                    guess: guess
                });
                document.getElementById("guessing-section").style.display = "none";
                document.getElementById("waiting").style.display = "block";  // Show waiting message
            }
        });
    </script>
</body>
</html>
