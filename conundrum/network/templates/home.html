<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CONUNDRUM CORNER</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script> <!-- latest socket.IO client -->
</head>
<body>
    <div class="container">
        <h1>Conundrum Corner</h1>

        <!-- create lobby form -->
        <div class="form-box">
            <h2>CREATE LOBBY</h2>
            <form id="createLobbyForm">
                <label for="username">Enter username:</label>
                <input type="text" name="username" placeholder="Your name" required>

                <label for="max_players">Number of players:</label>
                <input type="number" name="max_players" placeholder="Enter number of players" required>

                <label for="game_mode">Select game mode:</label>
                <select name="game_mode" required>
                    <option value="reverse_guessing">Reverse Guessing</option>
                    <option value="emoji_translation">Emoji Translation</option>
                    <option value="bad_advice_hotline">Bad Advice Hotline</option>
                    <option value="obviously_lies">Obviously Lies</option>
                </select>

                <button type="submit">Create Lobby</button>
            </form>
        </div>

        <hr>

        <!-- join lobby form -->
        <div class="form-box">
            <h2>JOIN LOBBY</h2>
            <form id="joinLobbyForm">
                <label for="username">Enter Username:</label>
                <input type="text" name="username" placeholder="Your name" required>

                <label for="lobby_code">Enter Lobby Code:</label>
                <input type="text" name="lobby_code" placeholder="e.g. 1234" required>

                <button type="submit">Join Lobby</button>
            </form>
        </div>

        <hr>
        <div id="log"></div>
    </div>

    <script>
        const socket = io();

        // ------------------ create lobby ------------------
        document.getElementById("createLobbyForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const username = this.username.value;
            const maxPlayers = this.max_players.value;
            const gameMode = this.game_mode.value;

            socket.emit("create_lobby", { username, maxPlayers, gameMode });
        });

        // ------------------ join lobby ------------------
        document.getElementById("joinLobbyForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const username = this.username.value;
            const lobbyCode = this.lobby_code.value;

            socket.emit("join_lobby", { username, lobbyCode });
        });

        // ------------------ server responses ------------------
        socket.on("lobby_created", data => {
            log(`‚úÖ Lobby created! Code: ${data.lobbyCode}, Mode: ${data.gameMode}, Host: ${data.username}`);
            redirectToGame(data.gameMode, data.lobbyCode, data.username);
        });

        socket.on("lobby_joined", data => {
            log(`üë§ ${data.username} joined lobby: ${data.lobbyCode}`);
            redirectToGame(data.gameMode, data.lobbyCode, data.username);
        });

        socket.on("error_message", data => {
            log(`‚ùå Error: ${data.message}`);
        });

        // ------------------ redirect to game page ------------------
        function redirectToGame(gameMode, lobbyCode, username) {
            let gamePage = "";
            switch (gameMode) {
                case "reverse_guessing":
                    gamePage = "reverse_guessing.html";
                    break;
                case "emoji_translation":
                    gamePage = "emoji_translation.html";
                    break;
                case "bad_advice_hotline":
                    gamePage = "bad_advice_hotline.html";
                    break;
                case "obviously_lies":
                    gamePage = "obviously_lies.html";
                    break;
                default:
                    return;
            }

            // attach query params so the game page knows who you are
            window.location.href = `${gamePage}?username=${encodeURIComponent(username)}&lobby=${encodeURIComponent(lobbyCode)}`;
        }

        // ------------------ logging ------------------
        function log(msg) {
            const logDiv = document.getElementById("log");
            logDiv.innerText += msg + "\n";
        }
    </script>
</body>
</html>
